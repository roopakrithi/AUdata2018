---
title: "AU data cleanup and preliminary analysis"
author: "Roopa Krithivasan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

install package. Add data. Check to make sure it's clean.
```{r}
library(devtools)
library(githubinstall)
install_github("roopakrithi/AUdata2018", build_vignettes = F)

fl <- system.file("extdata/", package = "AUdata2018") 
au <- read.csv(paste0(fl, "AU_data_AU_2018-08-15.csv"))
au <- as.data.frame(au, stringsAsFactors = F)

#Are the crops correct (since I used names instead of codes, 
  #want to check for spelling errors etc.)
crops <- as.vector(as.matrix(au[,29:44]))
sort(unique(crops))
# looks fine.

# add variable for subregion (I'm being very lazy, sorry)
au$subr[au$VillageID == 1] <- 1
au$subr[au$VillageID == 2] <- 1
au$subr[au$VillageID == 3] <- 1
au$subr[au$VillageID == 4] <- 2
au$subr[au$VillageID == 5] <- 2
au$subr[au$VillageID ==6] <- 3
au$subr[au$VillageID ==7] <- 3

```

Start looking at the data:

```{r}

# list of most useful variables
# vars <- c(96, 20, 8, 9, 11, 12, 13, 15, 16, 17, 18, 19, 22, 25, 26, 18, 68, 91)

au[is.na(au)] <- 0
## be careful, there are a few variables where NA =/= 0








```


A few new variables
```{r}
# squared travel time
au$tt2 <- (au$travel.time)^2

# visible from village OR major thoroughfare 
au$vis.any <- 0 #don't actually need this
au$vis.any <- ifelse(( au$vis.settl == 1 | au$vis.other == 1), 1, 0)
# visual check:
#cbind(au$vis.settl, au$vis.other,  au$vis.any)


# higest severity for any species
au$max.threat <- apply(au[,c("monkey.threat", "boar.threat", "Ung.threat", "Other.threat" )], 1, max)
# visual check:
#cbind(au$monkey.threat, au$boar.threat, au$Ung.threat, au$max.threat)
```

There are a number of things that could be driving trends. pretend you just don't care what the results show. you just want to know what sorts of variables are predicting:
1. which AUs have been abandoned (level 0)
2. where people have decreased planting (level 1)
3. where has there been intensification (ie, more area planted OR more cash crops than previous)
4. what areas have high/severe percieved loss (by species)
5. what areas have some sort of collective protection



Old LMs, delete later
```{r}



lm1 <- lm(pc.cropped.summer ~ travel.time + borders.forest + borders.water + vis.settl, data = aus)
summary(lm1)

aus$tt2 <- (au$travel.time)^2

lm2 <- lm(pc.cropped.summer ~ travel.time + tt2 + borders.forest + borders.water + vis.settl
             + as.factor(subr)
          , data = aus[1:125,])
summary(lm2)


lm3 <- lm(pc.cropped.summer ~ travel.time + borders.forest + borders.water + vis.settl 
          , data = aus[c(1:80,100:125),])

lm4 <- lm(inactive.pc ~ travel.time + borders.forest + borders.water + vis.settl 
          , data = aus[c(1:80,100:125),])
summary(lm4)

lm5 <- lm(inactive.pc ~ travel.time + borders.forest + borders.water + AU.hh, 
          data = aus[(1:80,),])
summary(lm5)

lm6 <- lm(monkey.threat ~ travel.time + borders.forest + borders.water + borders.settl 
          , data = aus[1:99,])
summary(aus)
hist(aus)
#Ask tim how to account for different villages/regions.

```



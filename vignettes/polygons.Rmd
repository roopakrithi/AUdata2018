---
title: "Polygons"
author: "Roopa Krithivasan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup}

library(sp)
library(rgdal)
library(maps)
library(maptools)
library(raster)
library(sf)
library(rgeos)
#devtools::install_github("eblondel/cleangeo")
library(cleangeo)

library(devtools)
library(githubinstall)
install_github("roopakrithi/AUdata2018", build_vignettes = F)

fl <- system.file("extdata/", package = "AUdata2018") 
dat <- read.csv(paste0(fl, "au_data.csv"))
dat <- as.data.frame(dat, stringsAsFactors = F)

au <- readOGR(dsn = paste0(fl, "au_agg.shp"), layer = "au_agg")

au <- merge(au, dat, by.x = "IDlong", 
                        by.y = "IDlong")
names(au)

# plot all AUs ## TEST
# including a scale just for this one
### FIX so scales aren't terrible
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 0, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg, col = "green")
  box(lty = 1)
  map.scale(ratio=F, relwidth=0.3, cex = .4)
}


## check region 1
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 0, 0))
  reg <- au[au$region == 1, ]
  spplot(reg, "AU.area")


inact <- subset(au, inactive.pc == 100)
active <- subset(au, inactive.pc < 100)  

## add area variable

au$calc.area <- area(au)


```

Not perfect, but reasonable start. Don't spend too much time making this perfect. 



To add:
Rivers, major roads, settlements, and village boundaries (do this tomorrow)
maps by:


  - current use category (a few need to be modified)
   - number of users
   - live dep
  - visibility
  - more area cultivated?
  - more intensive use?
    - travel time
    - pc area cultivated
    - if abandoned, number of years
    
  
  - threat level max
    - threat level relative within village (high and low)
  - threat level by species (all together, use rgb alpha) * later
  - any collective monitoring?
  
  _____________________________________
  
  
# General characteristics 

- livelihood dependnce on agriculture
- trends in area cutlivated
- trends in cash crops 
- pc cropped (summer, 5 yr average)

```{r livdep}

# livelihood dependence
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, liv.dep == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("Dependence on agriculture", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c(">50%", "=<50%"), fill = c("blue","white"), bty = "n")
  }
}
```



```{r pc.summer}
# pc cropped summer
cols <- c("#ffffff", "#e6ffe6", "#ccffcc", "#99ff99", "#66ff66", "#1aff1a", "#00e600", "#00b300",
  "#008000", "#004d00", "#003300")

layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
 plot(subset(reg, pc.cropped.summer > 0 & pc.cropped.summer <= 10 ), col = cols[1], add = T)
 plot(subset(reg, pc.cropped.summer > 10 & pc.cropped.summer <= 20 ), col = cols[2], add = T)
 plot(subset(reg, pc.cropped.summer > 20 & pc.cropped.summer <= 30 ), col = cols[3], add = T)
 plot(subset(reg, pc.cropped.summer > 30 & pc.cropped.summer <= 40 ), col = cols[4], add = T)
 plot(subset(reg, pc.cropped.summer > 40 & pc.cropped.summer <= 50 ), col = cols[5], add = T)
 plot(subset(reg, pc.cropped.summer > 50 & pc.cropped.summer <= 60 ), col = cols[6], add = T)
 plot(subset(reg, pc.cropped.summer > 60 & pc.cropped.summer <= 70 ), col = cols[7], add = T)
 plot(subset(reg, pc.cropped.summer > 70 & pc.cropped.summer <= 80 ), col = cols[8], add = T)
 plot(subset(reg, pc.cropped.summer > 80 & pc.cropped.summer <= 90 ), col = cols[9], add = T)
 plot(subset(reg, pc.cropped.summer > 90 & pc.cropped.summer <= 100 ), col = cols[10], add = T)
  plot(subset(reg, pc.cropped.summer == 0), col = "darkred", add = T)
 box(lty = 1, col = "grey")
  mtext("% area cultivated (5yr summer average)", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottomright", c("none", "1-10", "11-20", "21-30", "31-40", "41-50", "51-60", "61-70", 
                     "71-80", "81-90", "91-100"), fill = c("darkred", cols), 
         bty = "n", cex = .7)
  }
}


```


```{r pc.winter}
# pc cropped winter
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
 plot(subset(reg, pc.cropped.winter > 0 & pc.cropped.winter <= 10 ), col = cols[1], add = T)
 plot(subset(reg, pc.cropped.winter > 10 & pc.cropped.winter <= 20 ), col = cols[2], add = T)
 plot(subset(reg, pc.cropped.winter > 20 & pc.cropped.winter <= 30 ), col = cols[3], add = T)
 plot(subset(reg, pc.cropped.winter > 30 & pc.cropped.winter <= 40 ), col = cols[4], add = T)
 plot(subset(reg, pc.cropped.winter > 40 & pc.cropped.winter <= 50 ), col = cols[5], add = T)
 plot(subset(reg, pc.cropped.winter > 50 & pc.cropped.winter <= 60 ), col = cols[6], add = T)
 plot(subset(reg, pc.cropped.winter > 60 & pc.cropped.winter <= 70 ), col = cols[7], add = T)
 plot(subset(reg, pc.cropped.winter > 70 & pc.cropped.winter <= 80 ), col = cols[8], add = T)
 plot(subset(reg, pc.cropped.winter > 80 & pc.cropped.winter <= 90 ), col = cols[9], add = T)
 plot(subset(reg, pc.cropped.winter > 90 & pc.cropped.winter <= 100 ), col = cols[10], add = T)
  plot(subset(reg, pc.cropped.winter == 0), col = "darkred", add = T)
 box(lty = 1, col = "grey")
  mtext("% area cultivated (5yr winter average)", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottomright", c("none", "1-10", "11-20", "21-30", "31-40", "41-50", "51-60", "61-70", 
                     "71-80", "81-90", "91-100"), fill = c("darkred", cols), 
         bty = "n", cex = .7)
  }
}



```


```{r trend.area}
## more area cultivated now than 10 years ago
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, trend.area == 1), col = "green", add = T)
  plot(subset(reg, trend.area == 0), col = "grey", add = T)
  plot(subset(reg, trend.area == -1), col = "red", add = T)
  plot(subset(reg, inactive.years > 10 & inactive.pc == 100), col = "darkred", add = T)
  box(lty = 1, col = "grey")
  mtext("Area cultivated now vs. 10 yrs ago", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottomright", c("Increase", "No change", "Decrease", "inactive >10yrs"), fill = c("green", "grey", "red", "darkred"), bty = "n")
  }
}

```


```{r trend.cash.crops}
# More cash crops cultivated now than 10 years ago
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, trend.cash.crops == 1), col = "green", add = T)
  plot(subset(reg, trend.cash.crops == -1), col = "red", add = T)
  plot(subset(reg, trend.cash.crops == 0), col = "grey", add = T)
  plot(subset(reg, inactive.years > 10 & inactive.pc == 100), col = "darkred", add = T)
  #plot(subset(reg, type == "unused"), col = "black", add = T)
 box(lty = 1, col = "grey")
  mtext("Cash crop cultivation now vs. 10 yrs ago", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottomright", c("Increase", "No change", "Decrease", "inactive >10yrs"), fill = c("green", "grey", "red", "darkred"), bty = "n")
  }
}

```
  
# Borders and visibility

```{r borders.settl}
# Borders settlement
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, borders.settl == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("Borders settlement", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c("y", "n"), fill = c("blue","white"), bty = "n")
  }
 }


```


```{r borders.water}
# Borders water
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, borders.water == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("Borders water", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c("y", "n"), fill = c("blue","white"), bty = "n")
  }
 }


```


```{r borders.forest}
# Borders forest
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, borders.forest == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("Borders forest", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c("y", "n"), fill = c("blue","white"), bty = "n")
  }
 }


```


```{r vis.settl}

# Majority visible from settlement
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, vis.settl == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("Majority visible from settlement", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c("y", "n"), fill = c("blue","white"), bty = "n")
  }
}


```

```{r vis.any}

# Majority visible from settlement or area of high traffic
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, vis.any == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("Majority visible from settlement or high-traffic area", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c("y", "n"), fill = c("blue","white"), bty = "n")
  }
 }

```

# Travel time

```{r travel.time}
# travel time
cols <- c("#ffffff", "#e6e6ff", "#b3b3ff", "#8080ff", "#4d4dff", "#1a1aff", "#0000b3","#000099", "#00004d", "#00001a")

layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
plot(subset(reg, travel.time == 0), col = cols[1], add = T)
 plot(subset(reg, travel.time > 0 & travel.time <= 2 ), col = cols[2], add = T)
 plot(subset(reg, travel.time > 3 & travel.time <= 5 ), col = cols[3], add = T)
 plot(subset(reg, travel.time > 5 & travel.time <= 10 ), col = cols[4], add = T)
 plot(subset(reg, travel.time > 10 & travel.time <= 15 ), col = cols[5], add = T)
 plot(subset(reg, travel.time > 15 & travel.time <= 20 ), col = cols[6], add = T)
 plot(subset(reg, travel.time > 20 & travel.time <= 30 ), col = cols[7], add = T)
 plot(subset(reg, travel.time > 30 & travel.time <= 45 ), col = cols[8], add = T)
 plot(subset(reg, travel.time > 45 & travel.time <= 60 ), col = cols[9], add = T)
 plot(subset(reg, travel.time > 60 & travel.time <= 80 ), col = cols[10], add = T)
  
 box(lty = 1, col = "grey")
  mtext("Average travel time (minutes)", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottomright", c("0", "1-2", "3-5", "6-10", "11-15", "16-20", "21-30", "31-45", 
                     "46-60", "61-80"), fill = c(cols), 
         bty = "n", cex = .7)
  }
}

layout(matrix(1,1))
par(mar = c(5,1,1,1), oma = c(1, 1, 1, 1))
hist(dat$travel.time, breaks = 15, main = "travel time", xlab = "minutes")


hist(active$travel.time, breaks = 15, main = "travel time", xlab = "minutes")
hist(inact$travel.time, breaks = 15, add= T, border = "red")

names(au)
 
```
  
  
# Threat level
```{r monkey.theat}

#MONKEY
cols <- sapply(1:5, function(x){
  rgb(1, 0, 0, (2.5^x)/100)
})
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
      plot(reg)
      for(j in 1:5){
      plot(subset(reg, monkey.threat == j), col = cols[j], add = T)
      }
  box(lty = 1, col = "grey")
  mtext("Monkey damage/loss threat", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottom", c("severe", "high", "moderate", "low", "v. low"), fill = rev(cols), bty = "n")
  }
}

```


```{r boar.threat}
#BOAR
cols <- sapply(1:5, function(x){
  rgb(1, 0, 0, (2.5^x)/100)
})
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
      plot(reg)
      for(j in 1:5){
      plot(subset(reg, boar.threat == j), col = cols[j], add = T)
      }
  box(lty = 1, col = "grey")
  mtext("Boar damage/loss threat", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottom", c("severe", "high", "moderate", "low", "v. low"), fill = rev(cols), bty = "n")
  }
}
```


```{r ung.threat}

#UNGULATE
cols <- sapply(1:5, function(x){
  rgb(1, 0, 0, (2.5^x)/100)
})
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
      plot(reg)
      for(j in 1:5){
      plot(subset(reg, ung.threat == j), col = cols[j], add = T)
      }
  box(lty = 1, col = "grey")
  mtext("Ungulate damage/loss threat", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottom", c("severe", "high", "moderate", "low", "v. low"), fill = rev(cols), bty = "n")
  }
}


```

```{r max.threat}
# Overall threat levels
cols <- sapply(1:5, function(x){
  rgb(1, 0, 0, (2.5^x)/100)
})
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
      plot(reg)
      for(j in 1:5){
      plot(subset(reg, max.threat == j), col = cols[j], add = T)
      }
  box(lty = 1, col = "grey")
  mtext("Maximum wildlife damage/loss threat", side = 3, outer = TRUE)
  if ( i == 1){
  legend("bottom", c("severe", "high", "moderate", "low", "v. low"), fill = rev(cols), bty = "n")
  }
}


```
  
# Monitoring and protection
```{r 3rd.party}
# 3rd PARTY
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, monitor.3rd == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("3rd party monitoring (any crop in past 2yrs", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c(">50%", "=<50%"), fill = c("blue","white"), bty = "n")
  }
}


```


```{r monitor.shared}

# ROTATIONAL/SHARED MONITORING
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
  plot(subset(reg, monitor.shared == 1), col = "blue", add = T)
  box(lty = 1, col = "grey")
  mtext("shared monitoring (any crop in past 2yrs", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c(">50%", "=<50%"), fill = c("blue","white"), bty = "n")
  }
 }

```
  
  
```{r}
proj4string(au)

att <- data.frame(au)

vnames <- c("Gr", "BB", "Dh", "Sp", "Ra", "Su", "Ro")

layout(matrix(c(1,1), 1, 1))
par(mar = c(1, 1, 1, 1), oma = c(2, 3, 2, 0))
barplot(tapply(att$calc, att$villageID, function(x){sum(x)/1000}), las = 1,
               names.arg = c("Gr", "BB", "Dh", "Sp", "Ra", "Su", "Ro"))

```
  
  
  
  
  
  
  
  
  
  
  
  
JUNK
```{r}
### all vis combined: this works but it's hella ugly.
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
  plot(reg)
 for(x in 1:length(au)){
    plot(au[x,], col = rgb(
      .5*(slot(au, "data")[x,17]) + .5*(slot(au, "data")[x,18]), 
      slot(au, "data")[x,18], 
      slot(au, "data")[x,19], 
      1), add = T)
 }
  box(lty = 1, col = "grey")
  mtext("Borders settlement/forest/water", side = 3, outer = TRUE)
  if ( i == 1){
    legend("bottomright", c("settlement", "forest", "water"), fill = c("red","yellow", "blue"), 
           pt.cex = 3, bty = "n")
  }
}

### DOESN'T WORK
layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
      plot(reg)
      for(j in 1:5){
      plot(subset(reg, monkey.threat == j), col = cols_monkey[j], add = T)
      plot(subset(reg, boar.threat == j), col = cols_boar[j], add = T)
      plot(subset(reg, ung.threat == j), col = cols_ung[j], add = T)
      }
  box(lty = 1, col = "grey")
  mtext("Maximum wildlife damage/loss threat", side = 3, outer = TRUE)
  if ( i == 1){
    legend(x = 76.927, y = 31.975, c("", "", "", "", ""), fill = rev(cols_monkey), bty = "n")
    legend(x = 76.929, y = 31.975, c("", "", "", "", ""), fill = rev(cols_boar), bty = "n")
    legend(x = 76.931, y = 31.975, c("severe", "high", "moderate", "low", "v. low"), fill = rev(cols_ung), bty = "n")
  }
   text("M B U", x = 76.9318, y = 31.975, cex = .85)  
}

## By species THIS NEEDS WORK
cols_monkey <- sapply(1:5, function(x){
  rgb(1, 0, 0, (2.5^x)/100)
})
cols_boar <- sapply(1:5, function(x){
  rgb(0, 0, 1, (2.5^x)/100)
})
cols_ung <- sapply(1:5, function(x){
  rgb(1, 1, 0, (2.5^x)/100)
})


layout(matrix(c(1,2,1,3), 2, 2, byrow = T), widths = c(1.4,1))
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 3, 0))
for(i in 1:3){
  reg <- au[au$region == i, ]
      plot(reg)
      for(j in 1:5){
      plot(subset(reg, monkey_thr == j), col = cols_monkey[j], add = T)
      plot(subset(reg, boar_threa == j), col = cols_boar[j], add = T)
      plot(subset(reg, ung_threat == j), col = cols_ung[j], add = T)
      }
  box(lty = 1, col = "grey")
  mtext("Maximum wildlife damage/loss threat", side = 3, outer = TRUE)
  if ( i == 1){
    legend(x = 76.927, y = 31.975, c("", "", "", "", ""), fill = rev(cols_monkey), bty = "n")
    legend(x = 76.929, y = 31.975, c("", "", "", "", ""), fill = rev(cols_boar), bty = "n")
    legend(x = 76.931, y = 31.975, c("severe", "high", "moderate", "low", "v. low"), fill = rev(cols_ung), bty = "n")
  }
   text("M B U", x = 76.9318, y = 31.975, cex = .85)  
}

```

  
